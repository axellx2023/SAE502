---
# Playbook principal pour l'installation et la configuration d'un serveur LAMP
# SAE502 - Installation automatique LAMP (Apache2 + PHP + MariaDB)
# NOTE: Ce playbook est pour un projet LAMP sÃ©parÃ©, pas pour le VPN WireGuard
# Pour dÃ©ployer le VPN WireGuard, utilisez deploy.yml
- name: Installation et configuration du serveur LAMP
  hosts: webservers
  become: yes
  gather_facts: yes

  vars:
    # Variables globales du projet
    app_name: "sae502"
    app_user: "www-data"
    app_group: "www-data"
    
    # Configuration Apache
    apache_server_name: "{{ app_name }}.local"
    apache_document_root: "/var/www/{{ app_name }}"
    
    # Configuration MariaDB
    mariadb_root_password: "ChangeMe123!"
    mariadb_db_name: "{{ app_name }}_db"
    mariadb_db_user: "{{ app_name }}_user"
    mariadb_db_password: "ChangeMe123!"

  roles:
    - role: apache
      tags: apache
    - role: php
      tags: php
    - role: mariadb
      tags: mariadb
    - role: deploy
      tags: deploy

  post_tasks:
    - name: Afficher un rÃ©sumÃ© de l'installation
      debug:
        msg:
          - "âœ… Installation LAMP terminÃ©e avec succÃ¨s !"
          - "ğŸŒ Apache2 est configurÃ© et actif"
          - "ğŸ˜ PHP est installÃ© avec les modules nÃ©cessaires"
          - "ğŸ—„ï¸  MariaDB est installÃ© et sÃ©curisÃ©"
          - "ğŸ“ Application dÃ©ployÃ©e dans {{ apache_document_root }}"
          - "ğŸ”— AccÃ©dez Ã  votre site via http://{{ ansible_default_ipv4.address }}"
